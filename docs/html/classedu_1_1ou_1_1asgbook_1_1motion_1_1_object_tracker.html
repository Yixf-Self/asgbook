<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Automating Analysis of Spatial Grids: edu.ou.asgbook.motion.ObjectTracker Class Reference</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.7 -->
<div class="tabs">
  <ul>
    <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="namespaces.html"><span>Packages</span></a></li>
    <li id="current"><a href="classes.html"><span>Classes</span></a></li>
    <li><a href="files.html"><span>Files</span></a></li>
    <li>
      <form action="search.php" method="get">
        <table cellspacing="0" cellpadding="0" border="0">
          <tr>
            <td><label>&nbsp;<u>S</u>earch&nbsp;for&nbsp;</label></td>
            <td><input type="text" name="query" value="" size="20" accesskey="s"/></td>
          </tr>
        </table>
      </form>
    </li>
  </ul></div>
<div class="tabs">
  <ul>
    <li><a href="classes.html"><span>Alphabetical&nbsp;List</span></a></li>
    <li><a href="annotated.html"><span>Class&nbsp;List</span></a></li>
    <li><a href="hierarchy.html"><span>Class&nbsp;Hierarchy</span></a></li>
    <li><a href="functions.html"><span>Class&nbsp;Members</span></a></li>
  </ul></div>
<div class="nav">
<a class="el" href="namespaceedu.html">edu</a>.<a class="el" href="namespaceedu_1_1ou.html">ou</a>.<a class="el" href="namespaceedu_1_1ou_1_1asgbook.html">asgbook</a>.<a class="el" href="namespaceedu_1_1ou_1_1asgbook_1_1motion.html">motion</a>.<a class="el" href="classedu_1_1ou_1_1asgbook_1_1motion_1_1_object_tracker.html">ObjectTracker</a></div>
<h1>edu.ou.asgbook.motion.ObjectTracker Class Reference</h1><!-- doxytag: class="edu::ou::asgbook::motion::ObjectTracker" --><!-- doxytag: inherits="edu::ou::asgbook::motion::MotionEstimator" -->Estimates motion based on assigning objects in one frame to objects in the previous frame.  
<a href="#_details">More...</a>
<p>
Inheritance diagram for edu.ou.asgbook.motion.ObjectTracker:<p><center><img src="classedu_1_1ou_1_1asgbook_1_1motion_1_1_object_tracker__inherit__graph.png" border="0" usemap="#edu_8ou_8asgbook_8motion_8_object_tracker__inherit__map" alt="Inheritance graph"></center>
<map name="edu_8ou_8asgbook_8motion_8_object_tracker__inherit__map">
<area href="interfaceedu_1_1ou_1_1asgbook_1_1motion_1_1_motion_estimator.html" shape="rect" coords="5,5,280,35" alt="">
</map>
<center><font size="2">[<a target="top" href="graph_legend.html">legend</a>]</font></center>Collaboration diagram for edu.ou.asgbook.motion.ObjectTracker:<p><center><img src="classedu_1_1ou_1_1asgbook_1_1motion_1_1_object_tracker__coll__graph.png" border="0" usemap="#edu_8ou_8asgbook_8motion_8_object_tracker__coll__map" alt="Collaboration graph"></center>
<map name="edu_8ou_8asgbook_8motion_8_object_tracker__coll__map">
<area href="interfaceedu_1_1ou_1_1asgbook_1_1motion_1_1_motion_estimator.html" shape="rect" coords="45,5,320,35" alt="">
<area href="interfaceedu_1_1ou_1_1asgbook_1_1motion_1_1_object_tracker_1_1_assigner.html" shape="rect" coords="23,59,343,88" alt="">
<area href="interfaceedu_1_1ou_1_1asgbook_1_1motion_1_1_object_tracker_1_1_cost_estimator.html" shape="rect" coords="5,112,360,141" alt="">
<area href="interfaceedu_1_1ou_1_1asgbook_1_1segmentation_1_1_segmenter.html" shape="rect" coords="37,165,328,195" alt="">
</map>
<center><font size="2">[<a target="top" href="graph_legend.html">legend</a>]</font></center><a href="classedu_1_1ou_1_1asgbook_1_1motion_1_1_object_tracker-members.html">List of all members.</a><table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classedu_1_1ou_1_1asgbook_1_1motion_1_1_object_tracker.html#ffcd8499c9ae456f1ce9a3bc6af54ffd">ObjectTracker</a> (int hysThresh1, int hysThresh2, int minsize)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classedu_1_1ou_1_1asgbook_1_1motion_1_1_object_tracker.html#5bfe0019ab0a983f98913133a7ece3b9">ObjectTracker</a> (<a class="el" href="interfaceedu_1_1ou_1_1asgbook_1_1segmentation_1_1_segmenter.html">Segmenter</a> seg, <a class="el" href="interfaceedu_1_1ou_1_1asgbook_1_1motion_1_1_object_tracker_1_1_cost_estimator.html">CostEstimator</a> cost, <a class="el" href="interfaceedu_1_1ou_1_1asgbook_1_1motion_1_1_object_tracker_1_1_assigner.html">Assigner</a> a)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">Override Pair&lt; <a class="el" href="classedu_1_1ou_1_1asgbook_1_1core_1_1_lat_lon_grid.html">LatLonGrid</a>,<br>
 <a class="el" href="classedu_1_1ou_1_1asgbook_1_1core_1_1_lat_lon_grid.html">LatLonGrid</a> &gt;&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classedu_1_1ou_1_1asgbook_1_1motion_1_1_object_tracker.html#ca4e2150f76a6f1ce1aef2b8090afd8e">compute</a> (<a class="el" href="classedu_1_1ou_1_1asgbook_1_1core_1_1_lat_lon_grid.html">LatLonGrid</a> data0, <a class="el" href="classedu_1_1ou_1_1asgbook_1_1core_1_1_lat_lon_grid.html">LatLonGrid</a> data1, File outdir)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">returns motion in the two directions.  <a href="#ca4e2150f76a6f1ce1aef2b8090afd8e"></a><br></td></tr>
<tr><td colspan="2"><br><h2>Static Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classedu_1_1ou_1_1asgbook_1_1motion_1_1_object_tracker.html#c926ecf0485cbd58a41ef96109b10c70">main</a> (String[] args)  throws Exception </td></tr>

<tr><td colspan="2"><br><h2>Classes</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">interface &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="interfaceedu_1_1ou_1_1asgbook_1_1motion_1_1_object_tracker_1_1_assigner.html">Assigner</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">class &nbsp;</td><td class="memItemRight" valign="bottom"><b>CentroidDistance</b></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">interface &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="interfaceedu_1_1ou_1_1asgbook_1_1motion_1_1_object_tracker_1_1_cost_estimator.html">CostEstimator</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">class &nbsp;</td><td class="memItemRight" valign="bottom"><b>GreedyAssigment</b></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">class &nbsp;</td><td class="memItemRight" valign="bottom"><b>SimpleSegmenter</b></td></tr>

</table>
<hr><a name="_details"></a><h2>Detailed Description</h2>
Estimates motion based on assigning objects in one frame to objects in the previous frame. 
<p>
<dl compact><dt><b>Author:</b></dt><dd>v.lakshmanan </dd></dl>

<p>
<hr><h2>Constructor &amp; Destructor Documentation</h2>
<a class="anchor" name="ffcd8499c9ae456f1ce9a3bc6af54ffd"></a><!-- doxytag: member="edu::ou::asgbook::motion::ObjectTracker::ObjectTracker" ref="ffcd8499c9ae456f1ce9a3bc6af54ffd" args="(int hysThresh1, int hysThresh2, int minsize)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">edu.ou.asgbook.motion.ObjectTracker.ObjectTracker           </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>hysThresh1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>hysThresh2</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>minsize</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
<div class="fragment"><pre class="fragment"><a name="l00101"></a>00101                                                                      {
<a name="l00102"></a>00102         <span class="keyword">this</span>(<span class="keyword">new</span> SimpleSegmenter(hysThresh1, hysThresh2, minsize),
<a name="l00103"></a>00103                 <span class="keyword">new</span> CentroidDistance(), <span class="keyword">new</span> GreedyAssigment());
<a name="l00104"></a>00104     }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="5bfe0019ab0a983f98913133a7ece3b9"></a><!-- doxytag: member="edu::ou::asgbook::motion::ObjectTracker::ObjectTracker" ref="5bfe0019ab0a983f98913133a7ece3b9" args="(Segmenter seg, CostEstimator cost, Assigner a)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">edu.ou.asgbook.motion.ObjectTracker.ObjectTracker           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="interfaceedu_1_1ou_1_1asgbook_1_1segmentation_1_1_segmenter.html">Segmenter</a>&nbsp;</td>
          <td class="paramname"> <em>seg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="interfaceedu_1_1ou_1_1asgbook_1_1motion_1_1_object_tracker_1_1_cost_estimator.html">CostEstimator</a>&nbsp;</td>
          <td class="paramname"> <em>cost</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="interfaceedu_1_1ou_1_1asgbook_1_1motion_1_1_object_tracker_1_1_assigner.html">Assigner</a>&nbsp;</td>
          <td class="paramname"> <em>a</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
<div class="fragment"><pre class="fragment"><a name="l00106"></a>00106                                                                        {
<a name="l00107"></a>00107         segmenter = seg;
<a name="l00108"></a>00108         costEstimator = cost;
<a name="l00109"></a>00109         assigner = a;
<a name="l00110"></a>00110     }
</pre></div>
<p>

</div>
</div><p>
<hr><h2>Member Function Documentation</h2>
<a class="anchor" name="ca4e2150f76a6f1ce1aef2b8090afd8e"></a><!-- doxytag: member="edu::ou::asgbook::motion::ObjectTracker::compute" ref="ca4e2150f76a6f1ce1aef2b8090afd8e" args="(LatLonGrid data0, LatLonGrid data1, File outdir)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">Override Pair&lt;<a class="el" href="classedu_1_1ou_1_1asgbook_1_1core_1_1_lat_lon_grid.html">LatLonGrid</a>, <a class="el" href="classedu_1_1ou_1_1asgbook_1_1core_1_1_lat_lon_grid.html">LatLonGrid</a>&gt; edu.ou.asgbook.motion.ObjectTracker.compute           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classedu_1_1ou_1_1asgbook_1_1core_1_1_lat_lon_grid.html">LatLonGrid</a>&nbsp;</td>
          <td class="paramname"> <em>data0</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classedu_1_1ou_1_1asgbook_1_1core_1_1_lat_lon_grid.html">LatLonGrid</a>&nbsp;</td>
          <td class="paramname"> <em>data1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">File&nbsp;</td>
          <td class="paramname"> <em>outdir</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
returns motion in the two directions. 
<p>
The first one is north to south and the second one is east to west. The data is aligned to second time frame. The output dir is used for intermediate products and may be null. 
<p>
Implements <a class="el" href="interfaceedu_1_1ou_1_1asgbook_1_1motion_1_1_motion_estimator.html#40d10e32607c78de8b7cb7510d2e6b4e">edu.ou.asgbook.motion.MotionEstimator</a>.<div class="fragment"><pre class="fragment"><a name="l00161"></a>00161                                                                                                 {
<a name="l00162"></a>00162         LabelResult objects0 = segmenter.label(data0);
<a name="l00163"></a>00163         LabelResult objects1 = segmenter.label(data1);
<a name="l00164"></a>00164         
<a name="l00165"></a>00165         <span class="keywordflow">if</span> (outdir != null){
<a name="l00166"></a>00166             <span class="keywordflow">try</span> {
<a name="l00167"></a>00167                 KmlWriter.write(objects0.label, outdir, <span class="stringliteral">"objects0"</span>, PngWriter.createRandomColormap());
<a name="l00168"></a>00168                 KmlWriter.write(objects1.label, outdir, <span class="stringliteral">"objects1"</span>, PngWriter.createRandomColormap());
<a name="l00169"></a>00169             } <span class="keywordflow">catch</span> (Exception e) {
<a name="l00170"></a>00170                 e.printStackTrace();
<a name="l00171"></a>00171             }
<a name="l00172"></a>00172         }
<a name="l00173"></a>00173         
<a name="l00174"></a>00174         <span class="comment">// match the objects across frames</span>
<a name="l00175"></a>00175         RegionProperty[] regions0 = RegionProperty.compute(objects0, data0);
<a name="l00176"></a>00176         RegionProperty[] regions1 = RegionProperty.compute(objects1, data1);
<a name="l00177"></a>00177         <span class="keywordtype">int</span>[][] cost = computeCost(regions0, regions1);
<a name="l00178"></a>00178         <span class="keywordtype">int</span>[] assigned = getAssignments(cost, outdir);
<a name="l00179"></a>00179         
<a name="l00180"></a>00180         <span class="comment">// find motion for each region</span>
<a name="l00181"></a>00181         <span class="keywordtype">int</span>[] regu = <span class="keyword">new</span> <span class="keywordtype">int</span>[assigned.length];
<a name="l00182"></a>00182         <span class="keywordtype">int</span>[] regv = <span class="keyword">new</span> <span class="keywordtype">int</span>[assigned.length];
<a name="l00183"></a>00183         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=1; i &lt; assigned.length; ++i){
<a name="l00184"></a>00184             <span class="keywordtype">int</span> oldregno = assigned[i];
<a name="l00185"></a>00185             <span class="keywordflow">if</span> ( oldregno &gt; 0 ){
<a name="l00186"></a>00186                 <span class="keywordtype">double</span> cx = regions1[i].getCx();
<a name="l00187"></a>00187                 <span class="keywordtype">double</span> cy = regions1[i].getCy();
<a name="l00188"></a>00188                 <span class="keywordtype">double</span> oldcx = regions0[oldregno].getCx();
<a name="l00189"></a>00189                 <span class="keywordtype">double</span> oldcy = regions0[oldregno].getCy();
<a name="l00190"></a>00190                 regu[i] = (int) Math.round( (cx - oldcx)*MOT_SCALE );
<a name="l00191"></a>00191                 regv[i] = (int) Math.round( (cy - oldcy)*MOT_SCALE );
<a name="l00192"></a>00192                 <span class="comment">// System.out.println("Object at " + cx + "," + cy + " moving at " + regu[i] + "," + regv[i]);</span>
<a name="l00193"></a>00193             }
<a name="l00194"></a>00194         }
<a name="l00195"></a>00195         
<a name="l00196"></a>00196         <span class="comment">// apply the motion estimate based on assignment to all pixels</span>
<a name="l00197"></a>00197         LatLonGrid u = <span class="keyword">new</span> LatLonGrid(data0.getNumLat(), data0.getNumLon(), 0, data0.getNwCorner(), data0.getLatRes(), data0.getLonRes());
<a name="l00198"></a>00198         LatLonGrid v = LatLonGrid.copyOf(u);
<a name="l00199"></a>00199         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i &lt; u.getNumLat(); ++i) <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=0; j &lt; u.getNumLon(); ++j){
<a name="l00200"></a>00200             <span class="keywordtype">int</span> regno = objects1.label.getValue(i,j);
<a name="l00201"></a>00201             <span class="keywordflow">if</span> ( regno &gt; 0 ){
<a name="l00202"></a>00202                 u.setValue(i,j, regu[regno]);
<a name="l00203"></a>00203                 v.setValue(i,j, regv[regno]);
<a name="l00204"></a>00204             }
<a name="l00205"></a>00205         }
<a name="l00206"></a>00206         
<a name="l00207"></a>00207         <span class="keywordflow">return</span> <span class="keyword">new</span> Pair&lt;LatLonGrid,LatLonGrid&gt;(u,v);
<a name="l00208"></a>00208     }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="c926ecf0485cbd58a41ef96109b10c70"></a><!-- doxytag: member="edu::ou::asgbook::motion::ObjectTracker::main" ref="c926ecf0485cbd58a41ef96109b10c70" args="(String[] args)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void edu.ou.asgbook.motion.ObjectTracker.main           </td>
          <td>(</td>
          <td class="paramtype">String[]&nbsp;</td>
          <td class="paramname"> <em>args</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%">  throws Exception <code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
<div class="fragment"><pre class="fragment"><a name="l00210"></a>00210                                                             {
<a name="l00211"></a>00211         <span class="comment">// create output directory</span>
<a name="l00212"></a>00212         File out = OutputDirectory.getDefault(<span class="stringliteral">"objecttracker"</span>);
<a name="l00213"></a>00213         
<a name="l00214"></a>00214         <span class="comment">// read</span>
<a name="l00215"></a>00215         File f = <span class="keyword">new</span> File(<span class="stringliteral">"data/seviri"</span>);
<a name="l00216"></a>00216         Pair&lt;LatLonGrid,Date&gt;[] grids = SeviriInfraredTemperature.readAll(f);
<a name="l00217"></a>00217         
<a name="l00218"></a>00218         <span class="comment">// do alg</span>
<a name="l00219"></a>00219         MotionEstimator alg = <span class="keyword">new</span> <a class="code" href="classedu_1_1ou_1_1asgbook_1_1motion_1_1_object_tracker.html#ffcd8499c9ae456f1ce9a3bc6af54ffd">ObjectTracker</a>(100, 110, 1000);
<a name="l00220"></a>00220         MedianFilter smoother = <span class="keyword">new</span> MedianFilter(10);
<a name="l00221"></a>00221         LatLonGrid grid0 = smoother.filter(grids[0].first);
<a name="l00222"></a>00222         LatLonGrid grid1 = smoother.filter(grids[1].first);
<a name="l00223"></a>00223         Pair&lt;LatLonGrid,LatLonGrid&gt; motion = alg.compute(grid0, grid1, out);
<a name="l00224"></a>00224         
<a name="l00225"></a>00225         <span class="comment">// write</span>
<a name="l00226"></a>00226         SaturateFilter filter = <span class="keyword">new</span> SaturateFilter(-150, 150);
<a name="l00227"></a>00227         LatLonGrid u = filter.filter(motion.first);
<a name="l00228"></a>00228         LatLonGrid v = filter.filter(motion.second);
<a name="l00229"></a>00229         KmlWriter.write(u, out, <span class="stringliteral">"closest_u"</span>, PngWriter.createCoolToWarmColormap());
<a name="l00230"></a>00230         KmlWriter.write(v, out, <span class="stringliteral">"closest_v"</span>, PngWriter.createCoolToWarmColormap());
<a name="l00231"></a>00231     }
</pre></div>
<p>

</div>
</div><p>
<hr size="1"><address style="align: right;"><small>Generated on Fri Jan 27 09:58:59 2012 for Automating Analysis of Spatial Grids by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.7 </small></address>
</body>
</html>
