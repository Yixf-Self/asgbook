<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Automating Analysis of Spatial Grids: edu.ou.asgbook.motion.CrossCorrelation Class Reference</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.7 -->
<div class="tabs">
  <ul>
    <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="namespaces.html"><span>Packages</span></a></li>
    <li id="current"><a href="classes.html"><span>Classes</span></a></li>
    <li><a href="files.html"><span>Files</span></a></li>
    <li>
      <form action="search.php" method="get">
        <table cellspacing="0" cellpadding="0" border="0">
          <tr>
            <td><label>&nbsp;<u>S</u>earch&nbsp;for&nbsp;</label></td>
            <td><input type="text" name="query" value="" size="20" accesskey="s"/></td>
          </tr>
        </table>
      </form>
    </li>
  </ul></div>
<div class="tabs">
  <ul>
    <li><a href="classes.html"><span>Alphabetical&nbsp;List</span></a></li>
    <li><a href="annotated.html"><span>Class&nbsp;List</span></a></li>
    <li><a href="hierarchy.html"><span>Class&nbsp;Hierarchy</span></a></li>
    <li><a href="functions.html"><span>Class&nbsp;Members</span></a></li>
  </ul></div>
<div class="nav">
<a class="el" href="namespaceedu.html">edu</a>.<a class="el" href="namespaceedu_1_1ou.html">ou</a>.<a class="el" href="namespaceedu_1_1ou_1_1asgbook.html">asgbook</a>.<a class="el" href="namespaceedu_1_1ou_1_1asgbook_1_1motion.html">motion</a>.<a class="el" href="classedu_1_1ou_1_1asgbook_1_1motion_1_1_cross_correlation.html">CrossCorrelation</a></div>
<h1>edu.ou.asgbook.motion.CrossCorrelation Class Reference</h1><!-- doxytag: class="edu::ou::asgbook::motion::CrossCorrelation" --><!-- doxytag: inherits="edu::ou::asgbook::motion::MotionEstimator" -->Estimates motion using cross-correlation.  
<a href="#_details">More...</a>
<p>
Inheritance diagram for edu.ou.asgbook.motion.CrossCorrelation:<p><center><img src="classedu_1_1ou_1_1asgbook_1_1motion_1_1_cross_correlation__inherit__graph.png" border="0" usemap="#edu_8ou_8asgbook_8motion_8_cross_correlation__inherit__map" alt="Inheritance graph"></center>
<map name="edu_8ou_8asgbook_8motion_8_cross_correlation__inherit__map">
<area href="interfaceedu_1_1ou_1_1asgbook_1_1motion_1_1_motion_estimator.html" shape="rect" coords="8,5,283,35" alt="">
</map>
<center><font size="2">[<a target="top" href="graph_legend.html">legend</a>]</font></center>Collaboration diagram for edu.ou.asgbook.motion.CrossCorrelation:<p><center><img src="classedu_1_1ou_1_1asgbook_1_1motion_1_1_cross_correlation__coll__graph.png" border="0" usemap="#edu_8ou_8asgbook_8motion_8_cross_correlation__coll__map" alt="Collaboration graph"></center>
<map name="edu_8ou_8asgbook_8motion_8_cross_correlation__coll__map">
<area href="interfaceedu_1_1ou_1_1asgbook_1_1motion_1_1_motion_estimator.html" shape="rect" coords="8,5,283,35" alt="">
</map>
<center><font size="2">[<a target="top" href="graph_legend.html">legend</a>]</font></center><a href="classedu_1_1ou_1_1asgbook_1_1motion_1_1_cross_correlation-members.html">List of all members.</a><table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classedu_1_1ou_1_1asgbook_1_1motion_1_1_cross_correlation.html#00a06d3b2578cfdcfd0fc5575d617033">CrossCorrelation</a> (int est_halfsize_x, int est_halfsize_y, int maxmotion_x, int maxmotion_y)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Pass size of window to estimate motion of, and the maximum movement in the two directions.  <a href="#00a06d3b2578cfdcfd0fc5575d617033"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">Override Pair&lt; <a class="el" href="classedu_1_1ou_1_1asgbook_1_1core_1_1_lat_lon_grid.html">LatLonGrid</a>,<br>
 <a class="el" href="classedu_1_1ou_1_1asgbook_1_1core_1_1_lat_lon_grid.html">LatLonGrid</a> &gt;&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classedu_1_1ou_1_1asgbook_1_1motion_1_1_cross_correlation.html#a9ca1b1b122fb2ed3dba3ead024ec8bd">compute</a> (<a class="el" href="classedu_1_1ou_1_1asgbook_1_1core_1_1_lat_lon_grid.html">LatLonGrid</a> data0, <a class="el" href="classedu_1_1ou_1_1asgbook_1_1core_1_1_lat_lon_grid.html">LatLonGrid</a> data1, File outdir)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">returns motion in the two directions.  <a href="#a9ca1b1b122fb2ed3dba3ead024ec8bd"></a><br></td></tr>
<tr><td colspan="2"><br><h2>Static Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classedu_1_1ou_1_1asgbook_1_1motion_1_1_cross_correlation.html#8f35130d1d06c017bb200547f7e510e5">test</a> ()  throws Exception </td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classedu_1_1ou_1_1asgbook_1_1motion_1_1_cross_correlation.html#8ed8dd8a1526401d9ad6f20611354a1f">main</a> (String[] args)  throws Exception </td></tr>

</table>
<hr><a name="_details"></a><h2>Detailed Description</h2>
Estimates motion using cross-correlation. 
<p>
<dl compact><dt><b>Author:</b></dt><dd>v.lakshmanan </dd></dl>

<p>
<hr><h2>Constructor &amp; Destructor Documentation</h2>
<a class="anchor" name="00a06d3b2578cfdcfd0fc5575d617033"></a><!-- doxytag: member="edu::ou::asgbook::motion::CrossCorrelation::CrossCorrelation" ref="00a06d3b2578cfdcfd0fc5575d617033" args="(int est_halfsize_x, int est_halfsize_y, int maxmotion_x, int maxmotion_y)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">edu.ou.asgbook.motion.CrossCorrelation.CrossCorrelation           </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>est_halfsize_x</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>est_halfsize_y</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>maxmotion_x</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>maxmotion_y</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Pass size of window to estimate motion of, and the maximum movement in the two directions. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>est_halfsize_x</em>&nbsp;</td><td></td></tr>
    <tr><td valign="top"></td><td valign="top"><em>est_halfsize_y</em>&nbsp;</td><td></td></tr>
  </table>
</dl>
<div class="fragment"><pre class="fragment"><a name="l00040"></a>00040                                               {
<a name="l00041"></a>00041         super();
<a name="l00042"></a>00042         EST_HALFSIZE_NS = est_halfsize_x;
<a name="l00043"></a>00043         EST_HALFSIZE_EW = est_halfsize_y;
<a name="l00044"></a>00044         MAX_U = maxmotion_x;
<a name="l00045"></a>00045         MAX_V = maxmotion_y;
<a name="l00046"></a>00046         MIN_FILL_PIXELS = (int) Math.round(MIN_FILL_RATIO * (2*EST_HALFSIZE_NS+1) * (2*EST_HALFSIZE_EW+1));
<a name="l00047"></a>00047     }
</pre></div>
<p>

</div>
</div><p>
<hr><h2>Member Function Documentation</h2>
<a class="anchor" name="a9ca1b1b122fb2ed3dba3ead024ec8bd"></a><!-- doxytag: member="edu::ou::asgbook::motion::CrossCorrelation::compute" ref="a9ca1b1b122fb2ed3dba3ead024ec8bd" args="(LatLonGrid data0, LatLonGrid data1, File outdir)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">Override Pair&lt;<a class="el" href="classedu_1_1ou_1_1asgbook_1_1core_1_1_lat_lon_grid.html">LatLonGrid</a>, <a class="el" href="classedu_1_1ou_1_1asgbook_1_1core_1_1_lat_lon_grid.html">LatLonGrid</a>&gt; edu.ou.asgbook.motion.CrossCorrelation.compute           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classedu_1_1ou_1_1asgbook_1_1core_1_1_lat_lon_grid.html">LatLonGrid</a>&nbsp;</td>
          <td class="paramname"> <em>data0</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classedu_1_1ou_1_1asgbook_1_1core_1_1_lat_lon_grid.html">LatLonGrid</a>&nbsp;</td>
          <td class="paramname"> <em>data1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">File&nbsp;</td>
          <td class="paramname"> <em>outdir</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
returns motion in the two directions. 
<p>
The first one is north to south and the second one is east to west. The data is aligned to second time frame. The output dir is used for intermediate products and may be null. 
<p>
Implements <a class="el" href="interfaceedu_1_1ou_1_1asgbook_1_1motion_1_1_motion_estimator.html#40d10e32607c78de8b7cb7510d2e6b4e">edu.ou.asgbook.motion.MotionEstimator</a>.<div class="fragment"><pre class="fragment"><a name="l00050"></a>00050                                                                                                 {
<a name="l00051"></a>00051         <span class="comment">// Grids we need. initialize all of them at zero</span>
<a name="l00052"></a>00052         <span class="keyword">final</span> <span class="keywordtype">int</span> nrows = data1.getNumLat();
<a name="l00053"></a>00053         <span class="keyword">final</span> <span class="keywordtype">int</span> ncols = data1.getNumLon();
<a name="l00054"></a>00054         LatLonGrid u = <span class="keyword">new</span> LatLonGrid(nrows, ncols, 0, data1.getNwCorner(), data1.getLatRes(), data1.getLonRes());
<a name="l00055"></a>00055         LatLonGrid v = LatLonGrid.copyOf(u);
<a name="l00056"></a>00056         
<a name="l00057"></a>00057         System.out.println(<span class="stringliteral">"Computing u,v using xcorr on "</span> + nrows + <span class="stringliteral">"x"</span> + ncols + <span class="stringliteral">" image; search radius="</span> + MAX_U + <span class="stringliteral">"x"</span> + MAX_V);
<a name="l00058"></a>00058         
<a name="l00059"></a>00059         <span class="comment">// compute u,v for every pixel</span>
<a name="l00060"></a>00060         <span class="keywordtype">double</span> meanu = 0;
<a name="l00061"></a>00061         <span class="keywordtype">double</span> meanv = 0;
<a name="l00062"></a>00062         <span class="keywordtype">int</span> nestimates = 0;
<a name="l00063"></a>00063         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i &lt; nrows; ++i) <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=0; j &lt; ncols; ++j){
<a name="l00064"></a>00064             <span class="comment">// at pixel, search best match for entire neighborhood</span>
<a name="l00065"></a>00065             <span class="comment">// best_m, best_n are not changed from default unless &lt; error_ratio</span>
<a name="l00066"></a>00066             <span class="keywordtype">double</span> lse = MAX_ERROR_RATIO;
<a name="l00067"></a>00067             <span class="keywordtype">int</span> best_m = 0;
<a name="l00068"></a>00068             <span class="keywordtype">int</span> best_n = 0;
<a name="l00069"></a>00069             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> m=-MAX_U; m &lt;= MAX_U; ++m){
<a name="l00070"></a>00070                 <span class="keywordflow">for</span> (<span class="keywordtype">int</span> n=-MAX_V; n &lt;= MAX_V; ++n){
<a name="l00071"></a>00071                     <span class="keywordtype">double</span> error = compute_error(data0, data1, i, j, m, n);
<a name="l00072"></a>00072                     <span class="keywordflow">if</span> ( error &lt; lse ){
<a name="l00073"></a>00073                         lse = error;
<a name="l00074"></a>00074                         best_m = m;
<a name="l00075"></a>00075                         best_n = n;
<a name="l00076"></a>00076                     }
<a name="l00077"></a>00077                 }
<a name="l00078"></a>00078             }
<a name="l00079"></a>00079             u.setValue(i,j, best_m);
<a name="l00080"></a>00080             v.setValue(i,j, best_n);
<a name="l00081"></a>00081             
<a name="l00082"></a>00082             <span class="keywordflow">if</span> ( lse != MAX_ERROR_RATIO ){
<a name="l00083"></a>00083                 meanu += best_m;
<a name="l00084"></a>00084                 meanv += best_n;
<a name="l00085"></a>00085                 ++nestimates;
<a name="l00086"></a>00086             }
<a name="l00087"></a>00087             
<a name="l00088"></a>00088             <span class="keywordflow">if</span> ( i%10 == 0 &amp;&amp; j == 0){
<a name="l00089"></a>00089                 System.out.println( (100*i)/nrows + <span class="stringliteral">"% of pixels complete."</span>);
<a name="l00090"></a>00090             }
<a name="l00091"></a>00091         }
<a name="l00092"></a>00092         
<a name="l00093"></a>00093         System.out.println(<span class="stringliteral">"Mean motion vector: u="</span> + meanu/(nestimates) + <span class="stringliteral">" v="</span> + meanv/(nestimates));
<a name="l00094"></a>00094         <span class="keywordflow">return</span> <span class="keyword">new</span> Pair&lt;LatLonGrid,LatLonGrid&gt;(u,v);
<a name="l00095"></a>00095     }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="8ed8dd8a1526401d9ad6f20611354a1f"></a><!-- doxytag: member="edu::ou::asgbook::motion::CrossCorrelation::main" ref="8ed8dd8a1526401d9ad6f20611354a1f" args="(String[] args)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void edu.ou.asgbook.motion.CrossCorrelation.main           </td>
          <td>(</td>
          <td class="paramtype">String[]&nbsp;</td>
          <td class="paramname"> <em>args</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%">  throws Exception <code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
<div class="fragment"><pre class="fragment"><a name="l00141"></a>00141                                                             {
<a name="l00142"></a>00142         <span class="comment">// test();</span>
<a name="l00143"></a>00143         <span class="comment">// create output directory</span>
<a name="l00144"></a>00144         File out = OutputDirectory.getDefault(<span class="stringliteral">"xcorr"</span>);
<a name="l00145"></a>00145         
<a name="l00146"></a>00146         <span class="comment">// read</span>
<a name="l00147"></a>00147         File f = <span class="keyword">new</span> File(<span class="stringliteral">"data/seviri"</span>);
<a name="l00148"></a>00148         Pair&lt;LatLonGrid,Date&gt;[] grids = SeviriInfraredTemperature.readAll(f);
<a name="l00149"></a>00149         
<a name="l00150"></a>00150         <span class="comment">// do alg</span>
<a name="l00151"></a>00151         <a class="code" href="classedu_1_1ou_1_1asgbook_1_1motion_1_1_cross_correlation.html#00a06d3b2578cfdcfd0fc5575d617033">CrossCorrelation</a> alg = <span class="keyword">new</span> <a class="code" href="classedu_1_1ou_1_1asgbook_1_1motion_1_1_cross_correlation.html#00a06d3b2578cfdcfd0fc5575d617033">CrossCorrelation</a>(3,3,5,5);
<a name="l00152"></a>00152         Pair&lt;LatLonGrid,LatLonGrid&gt; motion = alg.compute(grids[0].first, grids[1].first, out);
<a name="l00153"></a>00153         
<a name="l00154"></a>00154         <span class="comment">// write</span>
<a name="l00155"></a>00155         KmlWriter.write(motion.first, out, <span class="stringliteral">"xcorr_u"</span>, PngWriter.createCoolToWarmColormap());
<a name="l00156"></a>00156         KmlWriter.write(motion.second, out, <span class="stringliteral">"xcorr_v"</span>, PngWriter.createCoolToWarmColormap());
<a name="l00157"></a>00157         
<a name="l00158"></a>00158         <span class="comment">// align and compute difference</span>
<a name="l00159"></a>00159         LatLonGrid diff = <span class="keyword">new</span> AlignAndDifference().compute(grids[0].first, grids[1].first, motion, 1);
<a name="l00160"></a>00160         KmlWriter.write(diff, out, <span class="stringliteral">"xcorr_diff"</span>, PngWriter.createCoolToWarmColormap());
<a name="l00161"></a>00161     }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="8f35130d1d06c017bb200547f7e510e5"></a><!-- doxytag: member="edu::ou::asgbook::motion::CrossCorrelation::test" ref="8f35130d1d06c017bb200547f7e510e5" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void edu.ou.asgbook.motion.CrossCorrelation.test           </td>
          <td>(</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%">  throws Exception <code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
<div class="fragment"><pre class="fragment"><a name="l00125"></a>00125                                                {
<a name="l00126"></a>00126         <span class="comment">// because the alignment doesn't really check lat-lon extents,</span>
<a name="l00127"></a>00127         <span class="comment">// cropping from offset corners will look like translation ...</span>
<a name="l00128"></a>00128         LatLonGrid conus = GlobalPopulation.read(GlobalPopulation.NORTHAMERICA);
<a name="l00129"></a>00129         LatLonGrid[] grids = <span class="keyword">new</span> LatLonGrid[2];
<a name="l00130"></a>00130         grids[0] = conus.crop(900, 2500, 256, 256);
<a name="l00131"></a>00131         grids[0].setMissing(0);
<a name="l00132"></a>00132         <span class="keywordtype">int</span> motx = -2; <span class="keywordtype">int</span> moty = -3;
<a name="l00133"></a>00133         grids[1] = conus.crop(900-motx, 2500-moty, 256, 256);
<a name="l00134"></a>00134         grids[1].setMissing(0);
<a name="l00135"></a>00135         <a class="code" href="classedu_1_1ou_1_1asgbook_1_1motion_1_1_cross_correlation.html#00a06d3b2578cfdcfd0fc5575d617033">CrossCorrelation</a> alg = <span class="keyword">new</span> <a class="code" href="classedu_1_1ou_1_1asgbook_1_1motion_1_1_cross_correlation.html#00a06d3b2578cfdcfd0fc5575d617033">CrossCorrelation</a>(5,5,Math.abs(2*motx),Math.abs(2*moty));
<a name="l00136"></a>00136         alg.compute(grids[0], grids[1], null);
<a name="l00137"></a>00137         
<a name="l00138"></a>00138         System.exit(0);
<a name="l00139"></a>00139     }
</pre></div>
<p>

</div>
</div><p>
<hr size="1"><address style="align: right;"><small>Generated on Fri Jan 27 09:58:54 2012 for Automating Analysis of Spatial Grids by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.7 </small></address>
</body>
</html>
