<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Automating Analysis of Spatial Grids: edu.ou.asgbook.motion.PyramidalCrossCorrelation Class Reference</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.7 -->
<div class="tabs">
  <ul>
    <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="namespaces.html"><span>Packages</span></a></li>
    <li id="current"><a href="classes.html"><span>Classes</span></a></li>
    <li><a href="files.html"><span>Files</span></a></li>
    <li>
      <form action="search.php" method="get">
        <table cellspacing="0" cellpadding="0" border="0">
          <tr>
            <td><label>&nbsp;<u>S</u>earch&nbsp;for&nbsp;</label></td>
            <td><input type="text" name="query" value="" size="20" accesskey="s"/></td>
          </tr>
        </table>
      </form>
    </li>
  </ul></div>
<div class="tabs">
  <ul>
    <li><a href="classes.html"><span>Alphabetical&nbsp;List</span></a></li>
    <li><a href="annotated.html"><span>Class&nbsp;List</span></a></li>
    <li><a href="hierarchy.html"><span>Class&nbsp;Hierarchy</span></a></li>
    <li><a href="functions.html"><span>Class&nbsp;Members</span></a></li>
  </ul></div>
<div class="nav">
<a class="el" href="namespaceedu.html">edu</a>.<a class="el" href="namespaceedu_1_1ou.html">ou</a>.<a class="el" href="namespaceedu_1_1ou_1_1asgbook.html">asgbook</a>.<a class="el" href="namespaceedu_1_1ou_1_1asgbook_1_1motion.html">motion</a>.<a class="el" href="classedu_1_1ou_1_1asgbook_1_1motion_1_1_pyramidal_cross_correlation.html">PyramidalCrossCorrelation</a></div>
<h1>edu.ou.asgbook.motion.PyramidalCrossCorrelation Class Reference</h1><!-- doxytag: class="edu::ou::asgbook::motion::PyramidalCrossCorrelation" --><!-- doxytag: inherits="edu::ou::asgbook::motion::MotionEstimator" -->Cross-correlation at muliple resolutions.  
<a href="#_details">More...</a>
<p>
Inheritance diagram for edu.ou.asgbook.motion.PyramidalCrossCorrelation:<p><center><img src="classedu_1_1ou_1_1asgbook_1_1motion_1_1_pyramidal_cross_correlation__inherit__graph.png" border="0" usemap="#edu_8ou_8asgbook_8motion_8_pyramidal_cross_correlation__inherit__map" alt="Inheritance graph"></center>
<map name="edu_8ou_8asgbook_8motion_8_pyramidal_cross_correlation__inherit__map">
<area href="interfaceedu_1_1ou_1_1asgbook_1_1motion_1_1_motion_estimator.html" shape="rect" coords="39,5,313,35" alt="">
</map>
<center><font size="2">[<a target="top" href="graph_legend.html">legend</a>]</font></center>Collaboration diagram for edu.ou.asgbook.motion.PyramidalCrossCorrelation:<p><center><img src="classedu_1_1ou_1_1asgbook_1_1motion_1_1_pyramidal_cross_correlation__coll__graph.png" border="0" usemap="#edu_8ou_8asgbook_8motion_8_pyramidal_cross_correlation__coll__map" alt="Collaboration graph"></center>
<map name="edu_8ou_8asgbook_8motion_8_pyramidal_cross_correlation__coll__map">
<area href="interfaceedu_1_1ou_1_1asgbook_1_1motion_1_1_motion_estimator.html" shape="rect" coords="39,5,313,35" alt="">
</map>
<center><font size="2">[<a target="top" href="graph_legend.html">legend</a>]</font></center><a href="classedu_1_1ou_1_1asgbook_1_1motion_1_1_pyramidal_cross_correlation-members.html">List of all members.</a><table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classedu_1_1ou_1_1asgbook_1_1motion_1_1_pyramidal_cross_correlation.html#dafd1f0742b0a61f80c565a790ccbd67">PyramidalCrossCorrelation</a> (int maxmotion_x, int maxmotion_y)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Pass in the maximum movement in the two directions.  <a href="#dafd1f0742b0a61f80c565a790ccbd67"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">Override Pair&lt; <a class="el" href="classedu_1_1ou_1_1asgbook_1_1core_1_1_lat_lon_grid.html">LatLonGrid</a>,<br>
 <a class="el" href="classedu_1_1ou_1_1asgbook_1_1core_1_1_lat_lon_grid.html">LatLonGrid</a> &gt;&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classedu_1_1ou_1_1asgbook_1_1motion_1_1_pyramidal_cross_correlation.html#d27cac74acae7d268038ebdf11a8eb7a">compute</a> (<a class="el" href="classedu_1_1ou_1_1asgbook_1_1core_1_1_lat_lon_grid.html">LatLonGrid</a> data0, <a class="el" href="classedu_1_1ou_1_1asgbook_1_1core_1_1_lat_lon_grid.html">LatLonGrid</a> data1, File outdir)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">returns motion in the two directions.  <a href="#d27cac74acae7d268038ebdf11a8eb7a"></a><br></td></tr>
<tr><td colspan="2"><br><h2>Static Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classedu_1_1ou_1_1asgbook_1_1motion_1_1_pyramidal_cross_correlation.html#d39070e880bb2bda85d7386a2c9e8c06">main</a> (String[] args)  throws Exception </td></tr>

</table>
<hr><a name="_details"></a><h2>Detailed Description</h2>
Cross-correlation at muliple resolutions. 
<p>
<dl compact><dt><b>Author:</b></dt><dd>v.lakshmanan </dd></dl>

<p>
<hr><h2>Constructor &amp; Destructor Documentation</h2>
<a class="anchor" name="dafd1f0742b0a61f80c565a790ccbd67"></a><!-- doxytag: member="edu::ou::asgbook::motion::PyramidalCrossCorrelation::PyramidalCrossCorrelation" ref="dafd1f0742b0a61f80c565a790ccbd67" args="(int maxmotion_x, int maxmotion_y)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">edu.ou.asgbook.motion.PyramidalCrossCorrelation.PyramidalCrossCorrelation           </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>maxmotion_x</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>maxmotion_y</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Pass in the maximum movement in the two directions. 
<p>
<div class="fragment"><pre class="fragment"><a name="l00030"></a>00030                                                                        {
<a name="l00031"></a>00031         MAX_U = maxmotion_x;
<a name="l00032"></a>00032         MAX_V = maxmotion_y;
<a name="l00033"></a>00033     }
</pre></div>
<p>

</div>
</div><p>
<hr><h2>Member Function Documentation</h2>
<a class="anchor" name="d27cac74acae7d268038ebdf11a8eb7a"></a><!-- doxytag: member="edu::ou::asgbook::motion::PyramidalCrossCorrelation::compute" ref="d27cac74acae7d268038ebdf11a8eb7a" args="(LatLonGrid data0, LatLonGrid data1, File outdir)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">Override Pair&lt;<a class="el" href="classedu_1_1ou_1_1asgbook_1_1core_1_1_lat_lon_grid.html">LatLonGrid</a>, <a class="el" href="classedu_1_1ou_1_1asgbook_1_1core_1_1_lat_lon_grid.html">LatLonGrid</a>&gt; edu.ou.asgbook.motion.PyramidalCrossCorrelation.compute           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classedu_1_1ou_1_1asgbook_1_1core_1_1_lat_lon_grid.html">LatLonGrid</a>&nbsp;</td>
          <td class="paramname"> <em>data0</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classedu_1_1ou_1_1asgbook_1_1core_1_1_lat_lon_grid.html">LatLonGrid</a>&nbsp;</td>
          <td class="paramname"> <em>data1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">File&nbsp;</td>
          <td class="paramname"> <em>outdir</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
returns motion in the two directions. 
<p>
The first one is north to south and the second one is east to west. The data is aligned to second time frame. The output dir is used for intermediate products and may be null. 
<p>
Implements <a class="el" href="interfaceedu_1_1ou_1_1asgbook_1_1motion_1_1_motion_estimator.html#40d10e32607c78de8b7cb7510d2e6b4e">edu.ou.asgbook.motion.MotionEstimator</a>.<div class="fragment"><pre class="fragment"><a name="l00043"></a>00043                                                                                                 {
<a name="l00044"></a>00044         <span class="keywordtype">int</span> numres = (int) Math.round( Math.log( Math.max(MAX_U,MAX_V))/Math.log(2) );
<a name="l00045"></a>00045         System.out.println(<span class="stringliteral">"Will do computation at "</span> + numres + <span class="stringliteral">" resolutions"</span>);
<a name="l00046"></a>00046         
<a name="l00047"></a>00047         <span class="comment">// add missing data to the borders to get them to be divisible by factor</span>
<a name="l00048"></a>00048         <span class="keywordtype">int</span> factor = (int) ( Math.pow(2, numres) + 0.01 );
<a name="l00049"></a>00049         data0 = pad( data0, nextMultiple(data0.getNumLat(),factor), nextMultiple(data0.getNumLon(),factor) );
<a name="l00050"></a>00050         data1 = pad( data1, nextMultiple(data0.getNumLat(),factor), nextMultiple(data0.getNumLon(),factor) );
<a name="l00051"></a>00051         
<a name="l00052"></a>00052         LatLonGrid aligned_data0 = data0;
<a name="l00053"></a>00053         LatLonGrid u = null;
<a name="l00054"></a>00054         LatLonGrid v = null;
<a name="l00055"></a>00055         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> res = numres; res &gt;= 0; --res){
<a name="l00056"></a>00056             <span class="comment">// shift data0 using u,v</span>
<a name="l00057"></a>00057             <span class="keywordflow">if</span> (u != null){
<a name="l00058"></a>00058                 aligned_data0 = align(data0, u, v);
<a name="l00059"></a>00059                 <span class="keywordflow">if</span> (outdir != null){
<a name="l00060"></a>00060                     <span class="keywordflow">try</span> {
<a name="l00061"></a>00061                         KmlWriter.write(aligned_data0, outdir, <span class="stringliteral">"pxaligned_"</span> + res, PngWriter.createCoolToWarmColormap());
<a name="l00062"></a>00062                     } <span class="keywordflow">catch</span> (Exception e) {
<a name="l00063"></a>00063                         e.printStackTrace();
<a name="l00064"></a>00064                     }
<a name="l00065"></a>00065                 }
<a name="l00066"></a>00066             }
<a name="l00067"></a>00067             
<a name="l00068"></a>00068             <span class="comment">// downsample grids to this resolution</span>
<a name="l00069"></a>00069             <span class="keywordtype">int</span> smsize = (int) ( Math.pow(2, res) + 0.01 ); <span class="comment">// at res=4, this is 2^4 or 16</span>
<a name="l00070"></a>00070             LatLonGrid grid0 = decreaseSize(aligned_data0, smsize);
<a name="l00071"></a>00071             LatLonGrid grid1 = decreaseSize(data1, smsize);
<a name="l00072"></a>00072             <span class="keywordflow">if</span> (outdir != null){
<a name="l00073"></a>00073                 <span class="keywordflow">try</span> {
<a name="l00074"></a>00074                     KmlWriter.write(grid0, outdir, <span class="stringliteral">"pxdata0_"</span> + res, PngWriter.createCoolToWarmColormap());
<a name="l00075"></a>00075                     KmlWriter.write(grid1, outdir, <span class="stringliteral">"pxdata1_"</span> + res, PngWriter.createCoolToWarmColormap());
<a name="l00076"></a>00076                 } <span class="keywordflow">catch</span> (Exception e) {
<a name="l00077"></a>00077                     e.printStackTrace();
<a name="l00078"></a>00078                 }
<a name="l00079"></a>00079             }
<a name="l00080"></a>00080             
<a name="l00081"></a>00081             <span class="comment">// find u,v at this resolution</span>
<a name="l00082"></a>00082             <span class="keywordtype">int</span> est_size = numres-res; <span class="comment">// 0 at coarsest resolution, +1 with each resolution</span>
<a name="l00083"></a>00083             <span class="keywordtype">int</span> search_radius = 1;
<a name="l00084"></a>00084             CrossCorrelation xcorr = <span class="keyword">new</span> CrossCorrelation(est_size, est_size, search_radius, search_radius);
<a name="l00085"></a>00085             Pair&lt;LatLonGrid,LatLonGrid&gt; motion = xcorr.compute(grid0, grid1, outdir);
<a name="l00086"></a>00086             LatLonGrid thisu = increaseSize(motion.first, smsize);
<a name="l00087"></a>00087             LatLonGrid thisv = increaseSize(motion.second, smsize);
<a name="l00088"></a>00088             thisu = multiply(thisu, smsize); <span class="comment">// movement of 1 pixel at res=4 is equal to movement of 16 in original image</span>
<a name="l00089"></a>00089             thisv = multiply(thisv, smsize);
<a name="l00090"></a>00090             <span class="comment">// update the total u,v</span>
<a name="l00091"></a>00091             u = (u != null)? LatLonGrid.add(thisu, u) : thisu;
<a name="l00092"></a>00092             v = (v != null)? LatLonGrid.add(thisv, v) : thisv;
<a name="l00093"></a>00093             <span class="keywordflow">if</span> (outdir != null){
<a name="l00094"></a>00094                 <span class="keywordflow">try</span> {
<a name="l00095"></a>00095                     KmlWriter.write(u, outdir, <span class="stringliteral">"pxu_"</span> + res, PngWriter.createCoolToWarmColormap());
<a name="l00096"></a>00096                     KmlWriter.write(u, outdir, <span class="stringliteral">"pxv_"</span> + res, PngWriter.createCoolToWarmColormap());
<a name="l00097"></a>00097                 } <span class="keywordflow">catch</span> (Exception e) {
<a name="l00098"></a>00098                     e.printStackTrace();
<a name="l00099"></a>00099                 }
<a name="l00100"></a>00100             }
<a name="l00101"></a>00101         }
<a name="l00102"></a>00102         <span class="keywordflow">return</span> <span class="keyword">new</span> Pair&lt;LatLonGrid,LatLonGrid&gt;(u,v);
<a name="l00103"></a>00103     }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="d39070e880bb2bda85d7386a2c9e8c06"></a><!-- doxytag: member="edu::ou::asgbook::motion::PyramidalCrossCorrelation::main" ref="d39070e880bb2bda85d7386a2c9e8c06" args="(String[] args)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void edu.ou.asgbook.motion.PyramidalCrossCorrelation.main           </td>
          <td>(</td>
          <td class="paramtype">String[]&nbsp;</td>
          <td class="paramname"> <em>args</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%">  throws Exception <code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
<div class="fragment"><pre class="fragment"><a name="l00170"></a>00170                                                             {
<a name="l00171"></a>00171         <span class="comment">// create output directory</span>
<a name="l00172"></a>00172         File out = OutputDirectory.getDefault(<span class="stringliteral">"pyramidxcorr"</span>);
<a name="l00173"></a>00173         
<a name="l00174"></a>00174         <span class="comment">// read</span>
<a name="l00175"></a>00175         File f = <span class="keyword">new</span> File(<span class="stringliteral">"data/seviri"</span>);
<a name="l00176"></a>00176         Pair&lt;LatLonGrid,Date&gt;[] grids = SeviriInfraredTemperature.readAll(f);
<a name="l00177"></a>00177         
<a name="l00178"></a>00178         <span class="comment">// do alg</span>
<a name="l00179"></a>00179         <a class="code" href="classedu_1_1ou_1_1asgbook_1_1motion_1_1_pyramidal_cross_correlation.html#dafd1f0742b0a61f80c565a790ccbd67">PyramidalCrossCorrelation</a> alg = <span class="keyword">new</span> <a class="code" href="classedu_1_1ou_1_1asgbook_1_1motion_1_1_pyramidal_cross_correlation.html#dafd1f0742b0a61f80c565a790ccbd67">PyramidalCrossCorrelation</a>(20,20);
<a name="l00180"></a>00180         Pair&lt;LatLonGrid,LatLonGrid&gt; motion = alg.compute(grids[0].first, grids[1].first, out);
<a name="l00181"></a>00181         
<a name="l00182"></a>00182         <span class="comment">// write</span>
<a name="l00183"></a>00183         KmlWriter.write(motion.first, out, <span class="stringliteral">"pxfinal_u"</span>, PngWriter.createCoolToWarmColormap());
<a name="l00184"></a>00184         KmlWriter.write(motion.second, out, <span class="stringliteral">"pxfinal_v"</span>, PngWriter.createCoolToWarmColormap());
<a name="l00185"></a>00185     }
</pre></div>
<p>

</div>
</div><p>
<hr size="1"><address style="align: right;"><small>Generated on Fri Jan 27 09:59:01 2012 for Automating Analysis of Spatial Grids by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.7 </small></address>
</body>
</html>
