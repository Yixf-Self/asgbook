<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Automating Analysis of Spatial Grids: edu.ou.asgbook.motion.HybridTracker Class Reference</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.7 -->
<div class="tabs">
  <ul>
    <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="namespaces.html"><span>Packages</span></a></li>
    <li id="current"><a href="classes.html"><span>Classes</span></a></li>
    <li><a href="files.html"><span>Files</span></a></li>
    <li>
      <form action="search.php" method="get">
        <table cellspacing="0" cellpadding="0" border="0">
          <tr>
            <td><label>&nbsp;<u>S</u>earch&nbsp;for&nbsp;</label></td>
            <td><input type="text" name="query" value="" size="20" accesskey="s"/></td>
          </tr>
        </table>
      </form>
    </li>
  </ul></div>
<div class="tabs">
  <ul>
    <li><a href="classes.html"><span>Alphabetical&nbsp;List</span></a></li>
    <li><a href="annotated.html"><span>Class&nbsp;List</span></a></li>
    <li><a href="hierarchy.html"><span>Class&nbsp;Hierarchy</span></a></li>
    <li><a href="functions.html"><span>Class&nbsp;Members</span></a></li>
  </ul></div>
<div class="nav">
<a class="el" href="namespaceedu.html">edu</a>.<a class="el" href="namespaceedu_1_1ou.html">ou</a>.<a class="el" href="namespaceedu_1_1ou_1_1asgbook.html">asgbook</a>.<a class="el" href="namespaceedu_1_1ou_1_1asgbook_1_1motion.html">motion</a>.<a class="el" href="classedu_1_1ou_1_1asgbook_1_1motion_1_1_hybrid_tracker.html">HybridTracker</a></div>
<h1>edu.ou.asgbook.motion.HybridTracker Class Reference</h1><!-- doxytag: class="edu::ou::asgbook::motion::HybridTracker" --><!-- doxytag: inherits="edu::ou::asgbook::motion::MotionEstimator" -->Estimates motion by finding cross-correlation of objects in one frame to the pixels in the previous frame.  
<a href="#_details">More...</a>
<p>
Inheritance diagram for edu.ou.asgbook.motion.HybridTracker:<p><center><img src="classedu_1_1ou_1_1asgbook_1_1motion_1_1_hybrid_tracker__inherit__graph.png" border="0" usemap="#edu_8ou_8asgbook_8motion_8_hybrid_tracker__inherit__map" alt="Inheritance graph"></center>
<map name="edu_8ou_8asgbook_8motion_8_hybrid_tracker__inherit__map">
<area href="interfaceedu_1_1ou_1_1asgbook_1_1motion_1_1_motion_estimator.html" shape="rect" coords="5,5,280,35" alt="">
</map>
<center><font size="2">[<a target="top" href="graph_legend.html">legend</a>]</font></center>Collaboration diagram for edu.ou.asgbook.motion.HybridTracker:<p><center><img src="classedu_1_1ou_1_1asgbook_1_1motion_1_1_hybrid_tracker__coll__graph.png" border="0" usemap="#edu_8ou_8asgbook_8motion_8_hybrid_tracker__coll__map" alt="Collaboration graph"></center>
<map name="edu_8ou_8asgbook_8motion_8_hybrid_tracker__coll__map">
<area href="interfaceedu_1_1ou_1_1asgbook_1_1motion_1_1_motion_estimator.html" shape="rect" coords="5,5,280,35" alt="">
<area href="interfaceedu_1_1ou_1_1asgbook_1_1segmentation_1_1_segmenter.html" shape="rect" coords="304,5,595,35" alt="">
</map>
<center><font size="2">[<a target="top" href="graph_legend.html">legend</a>]</font></center><a href="classedu_1_1ou_1_1asgbook_1_1motion_1_1_hybrid_tracker-members.html">List of all members.</a><table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classedu_1_1ou_1_1asgbook_1_1motion_1_1_hybrid_tracker.html#7da6f1a875068605e496750026d42f24">HybridTracker</a> (<a class="el" href="interfaceedu_1_1ou_1_1asgbook_1_1segmentation_1_1_segmenter.html">Segmenter</a> seg, int maxmotionx, int maxmotiony)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">Override Pair&lt; <a class="el" href="classedu_1_1ou_1_1asgbook_1_1core_1_1_lat_lon_grid.html">LatLonGrid</a>,<br>
 <a class="el" href="classedu_1_1ou_1_1asgbook_1_1core_1_1_lat_lon_grid.html">LatLonGrid</a> &gt;&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classedu_1_1ou_1_1asgbook_1_1motion_1_1_hybrid_tracker.html#da3dcca426eb82dedb9d6c9d77c992d5">compute</a> (<a class="el" href="classedu_1_1ou_1_1asgbook_1_1core_1_1_lat_lon_grid.html">LatLonGrid</a> data0, <a class="el" href="classedu_1_1ou_1_1asgbook_1_1core_1_1_lat_lon_grid.html">LatLonGrid</a> data1, File outdir)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">returns motion in the two directions.  <a href="#da3dcca426eb82dedb9d6c9d77c992d5"></a><br></td></tr>
<tr><td colspan="2"><br><h2>Static Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classedu_1_1ou_1_1asgbook_1_1motion_1_1_hybrid_tracker.html#2911ce97ef8464054b7bed77cd8c2a02">main</a> (String[] args)  throws Exception </td></tr>

<tr><td colspan="2"><br><h2>Classes</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">class &nbsp;</td><td class="memItemRight" valign="bottom"><b>Centroid</b></td></tr>

</table>
<hr><a name="_details"></a><h2>Detailed Description</h2>
Estimates motion by finding cross-correlation of objects in one frame to the pixels in the previous frame. 
<p>
<dl compact><dt><b>Author:</b></dt><dd>v.lakshmanan </dd></dl>

<p>
<hr><h2>Constructor &amp; Destructor Documentation</h2>
<a class="anchor" name="7da6f1a875068605e496750026d42f24"></a><!-- doxytag: member="edu::ou::asgbook::motion::HybridTracker::HybridTracker" ref="7da6f1a875068605e496750026d42f24" args="(Segmenter seg, int maxmotionx, int maxmotiony)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">edu.ou.asgbook.motion.HybridTracker.HybridTracker           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="interfaceedu_1_1ou_1_1asgbook_1_1segmentation_1_1_segmenter.html">Segmenter</a>&nbsp;</td>
          <td class="paramname"> <em>seg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>maxmotionx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>maxmotiony</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
<div class="fragment"><pre class="fragment"><a name="l00037"></a>00037                                                                        {
<a name="l00038"></a>00038         MAX_U = maxmotionx;
<a name="l00039"></a>00039         MAX_V = maxmotiony;
<a name="l00040"></a>00040         segmenter = seg;
<a name="l00041"></a>00041     }
</pre></div>
<p>

</div>
</div><p>
<hr><h2>Member Function Documentation</h2>
<a class="anchor" name="da3dcca426eb82dedb9d6c9d77c992d5"></a><!-- doxytag: member="edu::ou::asgbook::motion::HybridTracker::compute" ref="da3dcca426eb82dedb9d6c9d77c992d5" args="(LatLonGrid data0, LatLonGrid data1, File outdir)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">Override Pair&lt;<a class="el" href="classedu_1_1ou_1_1asgbook_1_1core_1_1_lat_lon_grid.html">LatLonGrid</a>, <a class="el" href="classedu_1_1ou_1_1asgbook_1_1core_1_1_lat_lon_grid.html">LatLonGrid</a>&gt; edu.ou.asgbook.motion.HybridTracker.compute           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classedu_1_1ou_1_1asgbook_1_1core_1_1_lat_lon_grid.html">LatLonGrid</a>&nbsp;</td>
          <td class="paramname"> <em>data0</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classedu_1_1ou_1_1asgbook_1_1core_1_1_lat_lon_grid.html">LatLonGrid</a>&nbsp;</td>
          <td class="paramname"> <em>data1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">File&nbsp;</td>
          <td class="paramname"> <em>outdir</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
returns motion in the two directions. 
<p>
The first one is north to south and the second one is east to west. The data is aligned to second time frame. The output dir is used for intermediate products and may be null. 
<p>
Implements <a class="el" href="interfaceedu_1_1ou_1_1asgbook_1_1motion_1_1_motion_estimator.html#40d10e32607c78de8b7cb7510d2e6b4e">edu.ou.asgbook.motion.MotionEstimator</a>.<div class="fragment"><pre class="fragment"><a name="l00052"></a>00052                                                                                                 {
<a name="l00053"></a>00053         LabelResult objects1 = segmenter.label(data1);
<a name="l00054"></a>00054         <span class="keywordflow">if</span> (outdir != null){
<a name="l00055"></a>00055             <span class="keywordflow">try</span> {
<a name="l00056"></a>00056                 KmlWriter.write(objects1.label, outdir, <span class="stringliteral">"hybobjects1"</span>, PngWriter.createRandomColormap());
<a name="l00057"></a>00057             } <span class="keywordflow">catch</span> (Exception e) {
<a name="l00058"></a>00058                 e.printStackTrace();
<a name="l00059"></a>00059             }
<a name="l00060"></a>00060         }
<a name="l00061"></a>00061         
<a name="l00062"></a>00062         <span class="comment">// find motion for each region and apply it to all pixels for that region</span>
<a name="l00063"></a>00063         Pixel[][] regions = RegionProperty.getPixelsInRegions(data1, objects1);
<a name="l00064"></a>00064         LatLonGrid u = <span class="keyword">new</span> LatLonGrid(data0.getNumLat(), data0.getNumLon(), 0, data0.getNwCorner(), data0.getLatRes(), data0.getLonRes());
<a name="l00065"></a>00065         LatLonGrid v = LatLonGrid.copyOf(u);
<a name="l00066"></a>00066         RegionProperty[] regprop = RegionProperty.compute(objects1, data1);
<a name="l00067"></a>00067         List&lt;Centroid&gt; centroids = <span class="keyword">new</span> ArrayList&lt;Centroid&gt;();
<a name="l00068"></a>00068         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> reg=1; reg &lt; regions.length; ++reg){
<a name="l00069"></a>00069             Pair&lt;Integer,Integer&gt; motion = computeMotion(regions[reg], data0);
<a name="l00070"></a>00070             <span class="keywordtype">int</span> motx = motion.first;
<a name="l00071"></a>00071             <span class="keywordtype">int</span> moty = motion.second;
<a name="l00072"></a>00072             Centroid c = <span class="keyword">new</span> Centroid();
<a name="l00073"></a>00073             c.cx = regprop[reg].getCx();
<a name="l00074"></a>00074             c.cy = regprop[reg].getCy();
<a name="l00075"></a>00075             c.motx = motx;
<a name="l00076"></a>00076             c.moty = moty;
<a name="l00077"></a>00077             c.size = regprop[reg].getSize();
<a name="l00078"></a>00078             centroids.add(c);
<a name="l00079"></a>00079             <span class="keywordflow">for</span> (Pixel p : regions[reg]){
<a name="l00080"></a>00080                 u.setValue(p.getX(), p.getY(), motx);
<a name="l00081"></a>00081                 v.setValue(p.getX(), p.getY(), moty);
<a name="l00082"></a>00082             }
<a name="l00083"></a>00083         }
<a name="l00084"></a>00084         
<a name="l00085"></a>00085         <span class="keywordflow">if</span> (outdir != null){
<a name="l00086"></a>00086             <span class="keywordflow">try</span> {
<a name="l00087"></a>00087                 KmlWriter.write(u, outdir, <span class="stringliteral">"u_beforeinterp"</span>, PngWriter.createCoolToWarmColormap());
<a name="l00088"></a>00088                 KmlWriter.write(v, outdir, <span class="stringliteral">"v_beforeinterp"</span>, PngWriter.createCoolToWarmColormap());
<a name="l00089"></a>00089             } <span class="keywordflow">catch</span> (Exception e) {
<a name="l00090"></a>00090                 e.printStackTrace();
<a name="l00091"></a>00091             }
<a name="l00092"></a>00092         }
<a name="l00093"></a>00093 
<a name="l00094"></a>00094         <span class="comment">// interpolate inbetween regions if you have enough of them ...</span>
<a name="l00095"></a>00095         <span class="keywordflow">if</span> ( centroids.size() &gt; 1 ){
<a name="l00096"></a>00096             LatLonGrid interpu = LatLonGrid.copyOf(u);
<a name="l00097"></a>00097             LatLonGrid interpv = LatLonGrid.copyOf(v);
<a name="l00098"></a>00098             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i &lt; interpu.getNumLat(); ++i) <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=0; j &lt; interpu.getNumLon(); ++j){
<a name="l00099"></a>00099                 <span class="keywordtype">double</span> totu = 0;
<a name="l00100"></a>00100                 <span class="keywordtype">double</span> totv = 0;
<a name="l00101"></a>00101                 <span class="keywordtype">double</span> totwt = 0;
<a name="l00102"></a>00102                 <span class="keywordflow">for</span> (Centroid c : centroids){
<a name="l00103"></a>00103                     <span class="keywordtype">double</span> distx = c.cx - i;
<a name="l00104"></a>00104                     <span class="keywordtype">double</span> disty = c.cy - j;
<a name="l00105"></a>00105                     <span class="keywordtype">double</span> distsq = distx*distx + disty*disty;
<a name="l00106"></a>00106                     <span class="keywordtype">double</span> wt = c.size * 1.0/(distsq*distsq + 0.0001); <span class="comment">// 1/r^2</span>
<a name="l00107"></a>00107                     totu += c.motx * wt;
<a name="l00108"></a>00108                     totv += c.moty * wt;
<a name="l00109"></a>00109                     totwt += wt;
<a name="l00110"></a>00110                 }
<a name="l00111"></a>00111                 interpu.setValue(i, j, (<span class="keywordtype">int</span>) Math.round(totu/totwt));
<a name="l00112"></a>00112                 interpv.setValue(i, j, (<span class="keywordtype">int</span>) Math.round(totv/totwt));
<a name="l00113"></a>00113             }
<a name="l00114"></a>00114         
<a name="l00115"></a>00115             <span class="keywordflow">if</span> (outdir != null){
<a name="l00116"></a>00116                 <span class="keywordflow">try</span> {
<a name="l00117"></a>00117                     KmlWriter.write(interpu, outdir, <span class="stringliteral">"u_interp"</span>, PngWriter.createCoolToWarmColormap());
<a name="l00118"></a>00118                     KmlWriter.write(interpv, outdir, <span class="stringliteral">"v_interp"</span>, PngWriter.createCoolToWarmColormap());
<a name="l00119"></a>00119                 } <span class="keywordflow">catch</span> (Exception e) {
<a name="l00120"></a>00120                     e.printStackTrace();
<a name="l00121"></a>00121                 }
<a name="l00122"></a>00122             }
<a name="l00123"></a>00123             
<a name="l00124"></a>00124             <span class="keywordflow">return</span> <span class="keyword">new</span> Pair&lt;LatLonGrid,LatLonGrid&gt;(interpu,interpv);
<a name="l00125"></a>00125         }
<a name="l00126"></a>00126         
<a name="l00127"></a>00127         <span class="keywordflow">return</span> <span class="keyword">new</span> Pair&lt;LatLonGrid,LatLonGrid&gt;(u,v);
<a name="l00128"></a>00128     }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="2911ce97ef8464054b7bed77cd8c2a02"></a><!-- doxytag: member="edu::ou::asgbook::motion::HybridTracker::main" ref="2911ce97ef8464054b7bed77cd8c2a02" args="(String[] args)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void edu.ou.asgbook.motion.HybridTracker.main           </td>
          <td>(</td>
          <td class="paramtype">String[]&nbsp;</td>
          <td class="paramname"> <em>args</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%">  throws Exception <code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
<div class="fragment"><pre class="fragment"><a name="l00153"></a>00153                                                             {
<a name="l00154"></a>00154         <span class="comment">// create output directory</span>
<a name="l00155"></a>00155         File out = OutputDirectory.getDefault(<span class="stringliteral">"hybridtracker"</span>);
<a name="l00156"></a>00156         
<a name="l00157"></a>00157         <span class="comment">// read</span>
<a name="l00158"></a>00158         File f = <span class="keyword">new</span> File(<span class="stringliteral">"data/seviri"</span>);
<a name="l00159"></a>00159         Pair&lt;LatLonGrid,Date&gt;[] grids = SeviriInfraredTemperature.readAll(f);
<a name="l00160"></a>00160         
<a name="l00161"></a>00161         <span class="comment">// do alg</span>
<a name="l00162"></a>00162         Segmenter seg = <span class="keyword">new</span> ObjectTracker.SimpleSegmenter(100, 110, 100);
<a name="l00163"></a>00163         MotionEstimator alg = <span class="keyword">new</span> <a class="code" href="classedu_1_1ou_1_1asgbook_1_1motion_1_1_hybrid_tracker.html#7da6f1a875068605e496750026d42f24">HybridTracker</a>( seg, 20, 20 );
<a name="l00164"></a>00164         MedianFilter smoother = <span class="keyword">new</span> MedianFilter(10);
<a name="l00165"></a>00165         LatLonGrid grid0 = smoother.filter(grids[0].first);
<a name="l00166"></a>00166         LatLonGrid grid1 = smoother.filter(grids[1].first);
<a name="l00167"></a>00167         Pair&lt;LatLonGrid,LatLonGrid&gt; motion = alg.compute(grid0, grid1, out);
<a name="l00168"></a>00168         
<a name="l00169"></a>00169         LatLonGrid diff = <span class="keyword">new</span> AlignAndDifference().compute(grids[0].first, grids[1].first, motion);
<a name="l00170"></a>00170         KmlWriter.write(diff, out, <span class="stringliteral">"hybriddiff"</span>, PngWriter.createCoolToWarmColormap());
<a name="l00171"></a>00171         
<a name="l00172"></a>00172         <span class="comment">// write</span>
<a name="l00173"></a>00173         SaturateFilter filter = <span class="keyword">new</span> SaturateFilter(-15, 15);
<a name="l00174"></a>00174         LatLonGrid u = filter.filter(motion.first);
<a name="l00175"></a>00175         LatLonGrid v = filter.filter(motion.second);
<a name="l00176"></a>00176         KmlWriter.write(u, out, <span class="stringliteral">"opticflow_u"</span>, PngWriter.createCoolToWarmColormap());
<a name="l00177"></a>00177         KmlWriter.write(v, out, <span class="stringliteral">"opticflow_v"</span>, PngWriter.createCoolToWarmColormap());
<a name="l00178"></a>00178     }
</pre></div>
<p>

</div>
</div><p>
<hr size="1"><address style="align: right;"><small>Generated on Fri Jan 27 09:58:57 2012 for Automating Analysis of Spatial Grids by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.7 </small></address>
</body>
</html>
